å¥½çš„ï¼Œè¿™æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œå®ƒå®ç°äº†æ‚¨æè¿°çš„åŠŸèƒ½ã€‚

**è„šæœ¬ (save as `create_ebook_video.py`)**

```python
import json
import os
import subprocess
import base64
import shutil
import sys
from openai import OpenAI, APIError  # Import APIError for better error handling

# --- é…ç½® ---
STORY_JSON_FILE = "story.json"
TEMP_DIR = "temp_video_files"
SEGMENTS_FILE_NAME = "segments.txt"
FINAL_VIDEO_NAME = "ebook_video.mp4"
VIDEO_WIDTH = 1280
VIDEO_HEIGHT = 720
IMAGE_SIZE = "1024x1024" # DALL-E 3 æ”¯æŒçš„å°ºå¯¸ä¹‹ä¸€
# æ³¨æ„ï¼šæ ¹æ® OpenAI æ–‡æ¡£ï¼Œæ¨èä½¿ç”¨ 'dall-e-3' æ¨¡å‹ã€‚
# å¦‚æœ 'gpt-image-1' ä¸å¯ç”¨æˆ–æŠ¥é”™ï¼Œè¯·å°è¯•æ›´æ¢ä¸º 'dall-e-3'ã€‚
IMAGE_MODEL = "gpt-image-1"
IMAGE_STYLE_PROMPT = ", å‰åœåŠ›æ¼«ç”»é£æ ¼, åŒ…å«ä¸­æ–‡å¯¹è¯æ¡†" # Style appended to user prompt

# --- OpenAI å®¢æˆ·ç«¯åˆå§‹åŒ– ---
# ç¡®ä¿æ‚¨çš„ OpenAI API å¯†é’¥å·²è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ OPENAI_API_KEY
try:
    client = OpenAI()
except Exception as e:
    print(f"é”™è¯¯ï¼šæ— æ³•åˆå§‹åŒ– OpenAI å®¢æˆ·ç«¯ã€‚è¯·ç¡®ä¿ OPENAI_API_KEY ç¯å¢ƒå˜é‡å·²è®¾ç½®ã€‚")
    print(f"è¯¦ç»†é”™è¯¯: {e}")
    sys.exit(1)

# --- å‡½æ•°å®šä¹‰ ---

def check_ffmpeg():
    """æ£€æŸ¥ ffmpeg æ˜¯å¦å®‰è£…å¹¶å¯ç”¨"""
    if shutil.which("ffmpeg") is None:
        print("é”™è¯¯: æœªæ‰¾åˆ° ffmpegã€‚è¯·å…ˆå®‰è£… ffmpeg å¹¶ç¡®ä¿å®ƒåœ¨ç³»ç»Ÿçš„ PATH ä¸­ã€‚")
        sys.exit(1)
    print("ffmpeg å·²æ‰¾åˆ°ã€‚")

def generate_image(prompt, output_path, scene_index):
    """ä½¿ç”¨ OpenAI API ç”Ÿæˆå›¾ç‰‡å¹¶ä¿å­˜"""
    full_prompt = prompt + IMAGE_STYLE_PROMPT
    print(f"  ä¸ºåœºæ™¯ {scene_index + 1} ç”Ÿæˆå›¾ç‰‡ï¼Œæç¤º: \"{prompt}\" (é£æ ¼: å‰åœåŠ›æ¼«ç”», ä¸­æ–‡å¯¹è¯æ¡†)")
    try:
        response = client.images.generate(
            model=IMAGE_MODEL,
            prompt=full_prompt,
            n=1,
            size=IMAGE_SIZE, # ä½¿ç”¨ OpenAI æ”¯æŒçš„æ ‡å‡†å°ºå¯¸
            response_format="b64_json" # è¯·æ±‚ base64 ç¼–ç çš„å›¾ç‰‡æ•°æ®
        )
        # ä»å“åº”ä¸­è·å– base64 æ•°æ®
        if response.data and response.data[0].b64_json:
            image_b64 = response.data[0].b64_json
            # è§£ç å¹¶ä¿å­˜å›¾ç‰‡
            image_bytes = base64.b64decode(image_b64)
            with open(output_path, "wb") as f:
                f.write(image_bytes)
            print(f"  å›¾ç‰‡å·²ä¿å­˜åˆ°: {output_path}")
            return True
        else:
            print(f"é”™è¯¯ï¼šOpenAI API è¿”å›äº†ç©ºçš„å›¾ç‰‡æ•°æ®ã€‚")
            return False

    except APIError as e:
        print(f"é”™è¯¯ï¼šè°ƒç”¨ OpenAI API æ—¶å‡ºé”™ (åœºæ™¯ {scene_index + 1})ã€‚")
        print(f"  çŠ¶æ€ç : {e.status_code}")
        print(f"  å“åº”: {e.response}")
        print(f"  æç¤º: {full_prompt}")
        # æ£€æŸ¥æ˜¯å¦æ˜¯æ— æ•ˆæ¨¡å‹é”™è¯¯
        if "invalid_model" in str(e).lower() or (hasattr(e, 'code') and e.code == 'invalid_request_error'):
             print(f"\n  æç¤º: æ£€æµ‹åˆ°æ— æ•ˆæ¨¡å‹é”™è¯¯ã€‚æ‚¨å¯èƒ½éœ€è¦å°†è„šæœ¬ä¸­çš„ IMAGE_MODEL ä» '{IMAGE_MODEL}' æ›´æ”¹ä¸º 'dall-e-3'ã€‚\n")
        return False
    except Exception as e:
        print(f"é”™è¯¯ï¼šç”Ÿæˆå›¾ç‰‡æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯ (åœºæ™¯ {scene_index + 1}): {e}")
        return False


def create_video_segment(image_path, audio_path, output_segment_path, scene_index):
    """ä½¿ç”¨ ffmpeg å°†å›¾ç‰‡å’ŒéŸ³é¢‘åˆå¹¶ä¸ºè§†é¢‘ç‰‡æ®µ"""
    print(f"  ä¸ºåœºæ™¯ {scene_index + 1} åˆ›å»ºè§†é¢‘ç‰‡æ®µ...")

    if not os.path.exists(image_path):
        print(f"é”™è¯¯ï¼šå›¾ç‰‡æ–‡ä»¶ {image_path} ä¸å­˜åœ¨ã€‚")
        return False
    if not os.path.exists(audio_path):
        print(f"é”™è¯¯ï¼šéŸ³é¢‘æ–‡ä»¶ {audio_path} ä¸å­˜åœ¨ã€‚")
        return False

    try:
        # æ„å»º ffmpeg å‘½ä»¤åˆ—è¡¨
        # ä½¿ç”¨ scale å’Œ pad æ»¤é•œæ¥è°ƒæ•´å›¾åƒå¤§å°å¹¶é€‚åº” 1280x720 çš„è§†é¢‘å°ºå¯¸
        vf_filter = (
            f"scale={VIDEO_WIDTH}:{VIDEO_HEIGHT}:force_original_aspect_ratio=decrease,"
            f"pad={VIDEO_WIDTH}:{VIDEO_HEIGHT}:(ow-iw)/2:(oh-ih)/2,"
            f"format=yuv420p"
        )

        command = [
            "ffmpeg",
            "-hide_banner",
            "-loglevel", "warning",  # æˆ–ä½¿ç”¨ "error" è·å–æ›´å°‘çš„æ—¥å¿—
            "-loop", "1",           # å¾ªç¯è¾“å…¥å›¾åƒ
            "-i", image_path,       # è¾“å…¥å›¾åƒæ–‡ä»¶
            "-i", audio_path,       # è¾“å…¥éŸ³é¢‘æ–‡ä»¶
            "-vf", vf_filter,       # è§†é¢‘æ»¤é•œï¼ˆç¼©æ”¾ã€å¡«å……ã€åƒç´ æ ¼å¼ï¼‰
            "-c:v", "libx264",      # è§†é¢‘ç¼–è§£ç å™¨
            "-tune", "stillimage",  # é’ˆå¯¹é™æ€å›¾åƒä¼˜åŒ–
            "-c:a", "aac",          # éŸ³é¢‘ç¼–è§£ç å™¨
            "-b:a", "192k",         # éŸ³é¢‘æ¯”ç‰¹ç‡
            "-shortest",            # ä½¿è¾“å‡ºæ—¶é•¿ä¸æœ€çŸ­çš„è¾“å…¥ï¼ˆéŸ³é¢‘ï¼‰åŒ¹é…
            output_segment_path     # è¾“å‡ºè§†é¢‘ç‰‡æ®µæ–‡ä»¶
        ]

        # æ‰§è¡Œå‘½ä»¤
        result = subprocess.run(command, check=True, capture_output=True, text=True)
        # print(f"  ffmpeg è¾“å‡º:\n{result.stdout}") # å¯é€‰ï¼šæ‰“å° ffmpeg è¾“å‡º
        if result.stderr:
             print(f"  ffmpeg è­¦å‘Š/é”™è¯¯:\n{result.stderr}") # æ‰“å°è­¦å‘Šæˆ–é”™è¯¯
        print(f"  è§†é¢‘ç‰‡æ®µå·²åˆ›å»º: {output_segment_path}")
        return True

    except subprocess.CalledProcessError as e:
        print(f"é”™è¯¯ï¼šæ‰§è¡Œ ffmpeg å‘½ä»¤å¤±è´¥ (åœºæ™¯ {scene_index + 1})ã€‚")
        print(f"  å‘½ä»¤: {' '.join(e.cmd)}")
        print(f"  è¿”å›ç : {e.returncode}")
        print(f"  é”™è¯¯è¾“å‡º: {e.stderr}")
        return False
    except Exception as e:
        print(f"é”™è¯¯ï¼šåˆ›å»ºè§†é¢‘ç‰‡æ®µæ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯ (åœºæ™¯ {scene_index + 1}): {e}")
        return False

def concatenate_videos(segment_list_path, output_video_path):
    """å°†æ‰€æœ‰è§†é¢‘ç‰‡æ®µåˆå¹¶ä¸ºä¸€ä¸ªæœ€ç»ˆè§†é¢‘"""
    print("åˆå¹¶ç‰‡æ®µä¸ºæœ€ç»ˆè§†é¢‘...")
    if not os.path.exists(segment_list_path) or os.path.getsize(segment_list_path) == 0:
        print(f"é”™è¯¯: ç‰‡æ®µåˆ—è¡¨æ–‡ä»¶ {segment_list_path} ä¸ºç©ºæˆ–ä¸å­˜åœ¨ã€‚")
        return False

    try:
        command = [
            "ffmpeg",
            "-hide_banner",
            "-loglevel", "warning",
            "-f", "concat",         # ä½¿ç”¨ concat demuxer
            "-safe", "0",           # å…è®¸ä¸å®‰å…¨çš„ï¼ˆä¾‹å¦‚ï¼Œç›¸å¯¹ï¼‰æ–‡ä»¶å
            "-i", segment_list_path,# è¾“å…¥ç‰‡æ®µåˆ—è¡¨æ–‡ä»¶
            "-c", "copy",           # ç›´æ¥å¤åˆ¶ä»£ç æµï¼Œä¸é‡æ–°ç¼–ç 
            output_video_path       # è¾“å‡ºæœ€ç»ˆè§†é¢‘æ–‡ä»¶
        ]
        # æ‰§è¡Œå‘½ä»¤
        result = subprocess.run(command, check=True, capture_output=True, text=True)
        if result.stderr:
             print(f"  ffmpeg è­¦å‘Š/é”™è¯¯:\n{result.stderr}") # æ‰“å°è­¦å‘Šæˆ–é”™è¯¯
        print(f"æœ€ç»ˆè§†é¢‘åˆå¹¶å®Œæˆ: {output_video_path}")
        return True

    except subprocess.CalledProcessError as e:
        print("é”™è¯¯ï¼šåˆå¹¶è§†é¢‘ç‰‡æ®µæ—¶ ffmpeg æ‰§è¡Œå¤±è´¥ã€‚")
        print(f"  å‘½ä»¤: {' '.join(e.cmd)}")
        print(f"  è¿”å›ç : {e.returncode}")
        print(f"  é”™è¯¯è¾“å‡º: {e.stderr}")
        return False
    except Exception as e:
        print(f"é”™è¯¯ï¼šåˆå¹¶è§†é¢‘æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯: {e}")
        return False

def main():
    """ä¸»æ‰§è¡Œå‡½æ•°"""
    check_ffmpeg()

    # 1. è¯»å– story.json
    try:
        with open(STORY_JSON_FILE, 'r', encoding='utf-8') as f:
            story_data = json.load(f)
        if not isinstance(story_data, list) or not story_data:
             print(f"é”™è¯¯: {STORY_JSON_FILE} ä¸æ˜¯æœ‰æ•ˆçš„ JSON åˆ—è¡¨æˆ–ä¸ºç©ºã€‚")
             sys.exit(1)
        print(f"æˆåŠŸè¯»å– {STORY_JSON_FILE}ï¼ŒåŒ…å« {len(story_data)} ä¸ªåœºæ™¯ã€‚")
    except FileNotFoundError:
        print(f"é”™è¯¯: æ•…äº‹æ–‡ä»¶ {STORY_JSON_FILE} æœªæ‰¾åˆ°ã€‚")
        sys.exit(1)
    except json.JSONDecodeError:
        print(f"é”™è¯¯: è§£æ {STORY_JSON_FILE} æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥ JSON æ ¼å¼ã€‚")
        sys.exit(1)
    except Exception as e:
        print(f"é”™è¯¯ï¼šè¯»å–æ•…äº‹æ–‡ä»¶æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯: {e}")
        sys.exit(1)

    # 2. åˆ›å»ºä¸´æ—¶ç›®å½•
    os.makedirs(TEMP_DIR, exist_ok=True)
    print(f"ä¸´æ—¶ç›®å½• '{TEMP_DIR}' å·²åˆ›å»ºæˆ–å·²å­˜åœ¨ã€‚")

    # 3. å‡†å¤‡ç‰‡æ®µåˆ—è¡¨æ–‡ä»¶
    segments_file_path = os.path.join(TEMP_DIR, SEGMENTS_FILE_NAME)
    generated_segments = []

    print("\nå¼€å§‹å¤„ç†åœºæ™¯...")
    all_steps_successful = True

    # 4. å¾ªç¯å¤„ç†æ¯ä¸ªåœºæ™¯
    for i, scene in enumerate(story_data):
        print(f"\n--- å¤„ç†åœºæ™¯ {i + 1}/{len(story_data)} ---")
        scene_title = scene.get("scene_title", f"åœºæ™¯ {i+1}")
        audio_file = scene.get("audio_file")
        image_prompt = scene.get("image_prompt")

        if not audio_file or not image_prompt:
            print(f"è­¦å‘Šï¼šåœºæ™¯ {i + 1} ç¼ºå°‘ 'audio_file' æˆ– 'image_prompt'ï¼Œè·³è¿‡æ­¤åœºæ™¯ã€‚")
            continue

        # å®šä¹‰æ­¤åœºæ™¯çš„æ–‡ä»¶å
        image_filename = f"image_scene_{i + 1}.png"
        segment_filename = f"segment_{i + 1}.mp4"
        image_path = os.path.join(TEMP_DIR, image_filename)
        segment_path = os.path.join(TEMP_DIR, segment_filename)

        # æ£€æŸ¥éŸ³é¢‘æ–‡ä»¶æ˜¯å¦å­˜åœ¨ (ç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„)
        if not os.path.exists(audio_file):
            print(f"é”™è¯¯ï¼šåœºæ™¯ {i+1} çš„éŸ³é¢‘æ–‡ä»¶ '{audio_file}' æœªæ‰¾åˆ°ã€‚è¯·ç¡®ä¿è·¯å¾„æ­£ç¡®ã€‚")
            all_steps_successful = False
            break # æˆ–è€…å¯ä»¥é€‰æ‹© continue è·³è¿‡

        # A. ç”Ÿæˆå›¾ç‰‡
        if not generate_image(image_prompt, image_path, i):
            print(f"é”™è¯¯ï¼šæ— æ³•ä¸ºåœºæ™¯ {i + 1} ç”Ÿæˆå›¾ç‰‡ã€‚")
            all_steps_successful = False
            break # åœæ­¢å¤„ç†

        # B. åˆ›å»ºè§†é¢‘ç‰‡æ®µ
        if not create_video_segment(image_path, audio_file, segment_path, i):
            print(f"é”™è¯¯ï¼šæ— æ³•ä¸ºåœºæ™¯ {i + 1} åˆ›å»ºè§†é¢‘ç‰‡æ®µã€‚")
            all_steps_successful = False
            break # åœæ­¢å¤„ç†

        # C. è®°å½•ç‰‡æ®µä»¥ä¾›åˆå¹¶
        generated_segments.append(f"file '{segment_filename}'") # ä½¿ç”¨ç›¸å¯¹äºä¸´æ—¶ç›®å½•çš„è·¯å¾„

    # 5. å¦‚æœæ‰€æœ‰ç‰‡æ®µéƒ½æˆåŠŸç”Ÿæˆï¼Œåˆ™å†™å…¥ç‰‡æ®µåˆ—è¡¨æ–‡ä»¶å¹¶åˆå¹¶
    if all_steps_successful and generated_segments:
        try:
            with open(segments_file_path, 'w', encoding='utf-8') as f:
                f.write("\n".join(generated_segments))
            print(f"\nç‰‡æ®µåˆ—è¡¨æ–‡ä»¶å·²å†™å…¥: {segments_file_path}")

            # D. åˆå¹¶æ‰€æœ‰ç‰‡æ®µ
            if not concatenate_videos(segments_file_path, FINAL_VIDEO_NAME):
                all_steps_successful = False
        except IOError as e:
             print(f"é”™è¯¯: æ— æ³•å†™å…¥ç‰‡æ®µåˆ—è¡¨æ–‡ä»¶ {segments_file_path}: {e}")
             all_steps_successful = False

    # 6. æ¸…ç†æˆ–æç¤º
    if all_steps_successful and os.path.exists(FINAL_VIDEO_NAME):
        print("\næ¸…ç†ä¸´æ—¶æ–‡ä»¶...")
        try:
            shutil.rmtree(TEMP_DIR)
            print(f"ä¸´æ—¶ç›®å½• '{TEMP_DIR}' å·²åˆ é™¤ã€‚")
        except OSError as e:
            print(f"è­¦å‘Šï¼šæ— æ³•å®Œå…¨åˆ é™¤ä¸´æ—¶ç›®å½• '{TEMP_DIR}': {e}")
        print(f"\nğŸ‰ ç”µå­ä¹¦è§†é¢‘å·²æˆåŠŸåˆ›å»ºï¼")
        print(f"è¾“å‡ºæ–‡ä»¶å: {FINAL_VIDEO_NAME}") # è¾“å‡ºæœ€ç»ˆæ–‡ä»¶å
    else:
        print("\nâŒ å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè§†é¢‘æœªç”Ÿæˆæˆ–æœªå®Œæˆã€‚")
        print(f"ä¸´æ—¶æ–‡ä»¶ä¿ç•™åœ¨ '{TEMP_DIR}' ç›®å½•ä¸­ä»¥ä¾›æ£€æŸ¥ã€‚")
        # å¦‚æœæœ€ç»ˆæ–‡ä»¶å­˜åœ¨ä½†è¿‡ç¨‹æœ‰é”™ï¼Œä¹Ÿæç¤ºä¸€ä¸‹
        if os.path.exists(FINAL_VIDEO_NAME):
             print(f"æ³¨æ„ï¼šæœ€ç»ˆè§†é¢‘æ–‡ä»¶ '{FINAL_VIDEO_NAME}' å¯èƒ½å·²ç”Ÿæˆï¼Œä½†å¯èƒ½ä¸å®Œæ•´æˆ–å­˜åœ¨é—®é¢˜ã€‚")


if __name__ == "__main__":
    main()
```

**å¦‚ä½•ä½¿ç”¨:**

1.  **å®‰è£…å¿…è¦çš„åº“:**
    * **ffmpeg:** ç¡®ä¿æ‚¨å·²ç»åœ¨ç³»ç»Ÿä¸Šå®‰è£…äº† `ffmpeg`ã€‚æ‚¨å¯ä»¥ä»å…¶å®˜ç½‘ä¸‹è½½æˆ–ä½¿ç”¨åŒ…ç®¡ç†å™¨ï¼ˆå¦‚ `apt install ffmpeg`, `brew install ffmpeg`ï¼‰ã€‚
    * **Python åº“:**
        ```bash
        pip install openai
        ```
        ï¼ˆ`json`, `os`, `subprocess`, `base64`, `shutil`, `sys` æ˜¯ Python æ ‡å‡†åº“ï¼Œæ— éœ€é¢å¤–å®‰è£…ï¼‰

2.  **è®¾ç½® OpenAI API å¯†é’¥:**
    è„šæœ¬éœ€è¦è®¿é—® OpenAI APIã€‚æœ€å¸¸è§çš„æ–¹æ³•æ˜¯è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
    ```bash
    export OPENAI_API_KEY='ä½ çš„_openai_api_å¯†é’¥'
    # æˆ–è€…åœ¨ Windows Command Prompt:
    # set OPENAI_API_KEY=ä½ çš„_openai_api_å¯†é’¥
    # æˆ–è€…åœ¨ PowerShell:
    # $env:OPENAI_API_KEY='ä½ çš„_openai_api_å¯†é’¥'
    ```
    è¯·å°† `'ä½ çš„_openai_api_å¯†é’¥'` æ›¿æ¢ä¸ºæ‚¨çœŸå®çš„ OpenAI API å¯†é’¥ã€‚

3.  **å‡†å¤‡ `story.json` æ–‡ä»¶:**
    åœ¨ä¸ Python è„šæœ¬ç›¸åŒçš„ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `story.json` çš„æ–‡ä»¶ã€‚ç¡®ä¿å…¶æ ¼å¼ç¬¦åˆè¦æ±‚ï¼Œä¾‹å¦‚ï¼š
    ```json
    [
        {
            "scene_title": "å¼€ç«¯ï¼šå®é™çš„æ—©æ™¨",
            "audio_file": "audio/scene1_audio.mp3",
            "image_prompt": "ä¸€åªå¯çˆ±çš„æ°´ç­åœ¨æ¸…æ¾ˆçš„æ²³æµè¾¹é†’æ¥ï¼Œæ‰“ç€å“ˆæ¬ ï¼ŒèƒŒæ™¯æ˜¯æ—¥å‡ºå’Œè–„é›¾ã€‚"
        },
        {
            "scene_title": "å†’é™©çš„å¬å”¤",
            "audio_file": "path/to/your/audio2.mp3",
            "image_prompt": "æ°´ç­çœ‹åˆ°è¿œå¤„é—ªé—ªå‘å…‰çš„ä¸œè¥¿ï¼Œçœ¼ç¥å……æ»¡å¥½å¥‡ï¼Œå‡†å¤‡å‡ºå‘æ¢ç´¢ã€‚"
        },
        {
            "scene_title": "æ£®æ—æ·±å¤„",
            "audio_file": "../relative/path/audio3.mp3",
            "image_prompt": "æ°´ç­å°å¿ƒç¿¼ç¿¼åœ°ç©¿è¿‡èŒ‚å¯†çš„æ£®æ—ï¼Œé˜³å…‰é€è¿‡æ ‘å¶æ´’ä¸‹æ–‘é©³çš„å…‰ç‚¹ã€‚"
        }
    ]
    ```
    * ç¡®ä¿ `audio_file` æŒ‡å‘å®é™…å­˜åœ¨çš„ MP3 æ–‡ä»¶ã€‚è·¯å¾„å¯ä»¥æ˜¯ç›¸å¯¹è„šæœ¬çš„è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ã€‚
    * `image_prompt` åº”æ¸…æ™°æè¿°æ‚¨æƒ³è¦çš„ç”»é¢å†…å®¹ã€‚è„šæœ¬ä¼šè‡ªåŠ¨åœ¨åé¢æ·»åŠ é£æ ¼è¯´æ˜ã€‚

4.  **å‡†å¤‡éŸ³é¢‘æ–‡ä»¶:**
    ç¡®ä¿ `story.json` ä¸­åˆ—å‡ºçš„æ‰€æœ‰éŸ³é¢‘æ–‡ä»¶éƒ½å­˜åœ¨äºæŒ‡å®šè·¯å¾„ã€‚

5.  **è¿è¡Œè„šæœ¬:**
    åœ¨æ‚¨çš„ç»ˆç«¯æˆ–å‘½ä»¤è¡Œä¸­ï¼Œå¯¼èˆªåˆ°è„šæœ¬æ‰€åœ¨çš„ç›®å½•ï¼Œç„¶åè¿è¡Œï¼š
    ```bash
    python create_ebook_video.py
    ```

**è„šæœ¬è§£é‡Š:**

1.  **å¯¼å…¥å’Œé…ç½®:** å¯¼å…¥æ‰€éœ€åº“ï¼Œå¹¶è®¾ç½®å¸¸é‡ï¼ˆæ–‡ä»¶åã€ç›®å½•åã€API å‚æ•°ç­‰ï¼‰ã€‚
2.  **OpenAI åˆå§‹åŒ–:** è®¾ç½® OpenAI å®¢æˆ·ç«¯ã€‚
3.  **`check_ffmpeg()`:** éªŒè¯ `ffmpeg` æ˜¯å¦å¯ç”¨ã€‚
4.  **`generate_image()`:**
    * æ¥æ”¶åŸå§‹æç¤ºã€è¾“å‡ºè·¯å¾„å’Œåœºæ™¯ç´¢å¼•ã€‚
    * å°†é£æ ¼è¦æ±‚ï¼ˆ"å‰åœåŠ›æ¼«ç”»é£æ ¼, åŒ…å«ä¸­æ–‡å¯¹è¯æ¡†"ï¼‰é™„åŠ åˆ°åŸå§‹æç¤ºåã€‚
    * è°ƒç”¨ OpenAI `images.generate` API (ä½¿ç”¨äº†æ‚¨æŒ‡å®šçš„ `gpt-image-1` æ¨¡å‹ï¼Œå¹¶æ·»åŠ äº†å…³äº `dall-e-3` çš„æ³¨é‡Š)ã€‚
    * è¯·æ±‚ `b64_json` æ ¼å¼ä»¥ä¾¿ç›´æ¥è·å–å›¾ç‰‡æ•°æ®ã€‚
    * è§£ç  Base64 æ•°æ®å¹¶å°†å…¶å†™å…¥ PNG æ–‡ä»¶ã€‚
    * åŒ…å«è¯¦ç»†çš„é”™è¯¯å¤„ç†ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹ API é”™è¯¯å’Œå¯èƒ½çš„æ— æ•ˆæ¨¡å‹é”™è¯¯ã€‚
5.  **`create_video_segment()`:**
    * æ¥æ”¶å›¾ç‰‡è·¯å¾„ã€éŸ³é¢‘è·¯å¾„ã€è¾“å‡ºç‰‡æ®µè·¯å¾„å’Œåœºæ™¯ç´¢å¼•ã€‚
    * æ£€æŸ¥è¾“å…¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚
    * æ„å»º `ffmpeg` å‘½ä»¤ï¼Œä¸ Shell è„šæœ¬ä¸­çš„å‘½ä»¤ç±»ä¼¼ï¼Œä½†ä½¿ç”¨ Python çš„ `subprocess` æ¨¡å—æ‰§è¡Œã€‚
        * `-loop 1`: ä½¿å›¾ç‰‡æŒç»­æ˜¾ç¤ºã€‚
        * `-i image -i audio`: æŒ‡å®šè¾“å…¥ã€‚
        * `-vf "scale=...,pad=..."`: ä½¿ç”¨ `scale` å’Œ `pad` æ»¤é•œç¡®ä¿å›¾åƒé€‚åº” 1280x720 çš„è§†é¢‘å¸§ï¼Œä¿æŒå®½é«˜æ¯”å¹¶å¡«å……é»‘è¾¹ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚`format=yuv420p` è®¾ç½® H.264 å…¼å®¹çš„åƒç´ æ ¼å¼ã€‚
        * `-c:v libx264 -tune stillimage`: ä½¿ç”¨ H.264 ç¼–ç å™¨ï¼Œå¹¶é’ˆå¯¹é™æ€å›¾åƒä¼˜åŒ–ã€‚
        * `-c:a aac -b:a 192k`: ä½¿ç”¨ AAC éŸ³é¢‘ç¼–ç ï¼Œæ¯”ç‰¹ç‡ä¸º 192kbpsã€‚
        * `-shortest`: è§†é¢‘é•¿åº¦ç”±è¾ƒçŸ­çš„è¾“å…¥ï¼ˆå³éŸ³é¢‘ï¼‰å†³å®šã€‚
    * ä½¿ç”¨ `subprocess.run` æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶è¿›è¡Œé”™è¯¯æ£€æŸ¥ã€‚
6.  **`concatenate_videos()`:**
    * æ¥æ”¶ç‰‡æ®µåˆ—è¡¨æ–‡ä»¶çš„è·¯å¾„å’Œæœ€ç»ˆè¾“å‡ºè§†é¢‘çš„è·¯å¾„ã€‚
    * æ„å»º `ffmpeg` å‘½ä»¤ä»¥ä½¿ç”¨ `concat` demuxer åˆå¹¶ç‰‡æ®µã€‚
        * `-f concat -safe 0 -i segments.txt`: æŒ‡å®šåˆå¹¶æ–¹æ³•å’Œåˆ—è¡¨æ–‡ä»¶ã€‚`-safe 0` å…è®¸åœ¨åˆ—è¡¨ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„ç­‰ã€‚
        * `-c copy`: ç›´æ¥å¤åˆ¶è§†é¢‘å’ŒéŸ³é¢‘æµï¼Œé€Ÿåº¦å¿«ä¸”æ— è´¨é‡æŸå¤±ã€‚
    * æ‰§è¡Œå‘½ä»¤å¹¶è¿›è¡Œé”™è¯¯æ£€æŸ¥ã€‚
7.  **`main()`:**
    * è°ƒç”¨ `check_ffmpeg()`ã€‚
    * è¯»å–å¹¶è§£æ `story.json`ã€‚
    * åˆ›å»ºä¸´æ—¶ç›®å½•ã€‚
    * éå† `story.json` ä¸­çš„æ¯ä¸ªåœºæ™¯ï¼š
        * è·å–åœºæ™¯ä¿¡æ¯ã€‚
        * è°ƒç”¨ `generate_image()` ç”Ÿæˆå›¾ç‰‡ã€‚
        * è°ƒç”¨ `create_video_segment()` åˆ›å»ºè§†é¢‘ç‰‡æ®µã€‚
        * å¦‚æœæˆåŠŸï¼Œå°†ç‰‡æ®µæ–‡ä»¶åæ·»åŠ åˆ° `generated_segments` åˆ—è¡¨ã€‚
        * åŒ…å«é”™è¯¯å¤„ç†ï¼Œå¦‚æœä»»ä½•æ­¥éª¤å¤±è´¥åˆ™ä¸­æ–­ã€‚
    * å¦‚æœæ‰€æœ‰ç‰‡æ®µéƒ½æˆåŠŸåˆ›å»ºï¼š
        * å°† `generated_segments` å†™å…¥ä¸´æ—¶ç›®å½•ä¸­çš„ `segments.txt` æ–‡ä»¶ã€‚
        * è°ƒç”¨ `concatenate_videos()` åˆå¹¶ç‰‡æ®µã€‚
    * æ ¹æ®æ‰§è¡Œç»“æœè¿›è¡Œæ¸…ç†ï¼ˆåˆ é™¤ä¸´æ—¶ç›®å½•ï¼‰æˆ–ä¿ç•™ä¸´æ—¶æ–‡ä»¶ä»¥ä¾›è°ƒè¯•ã€‚
    * æ‰“å°æœ€ç»ˆç”Ÿæˆçš„è§†é¢‘æ–‡ä»¶åæˆ–é”™è¯¯æ¶ˆæ¯ã€‚
8.  **`if __name__ == "__main__":`:** ç¡®ä¿ `main()` å‡½æ•°åœ¨ç›´æ¥è¿è¡Œè„šæœ¬æ—¶æ‰§è¡Œã€‚

è¿™ä¸ªè„šæœ¬åº”è¯¥èƒ½æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚è®°å¾—æ£€æŸ¥ OpenAI API çš„ä½¿ç”¨æˆæœ¬ï¼Œå› ä¸ºç”Ÿæˆå›¾ç‰‡æ˜¯æ”¶è´¹çš„ã€‚